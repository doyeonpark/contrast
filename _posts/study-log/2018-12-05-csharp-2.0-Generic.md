---
title:  "c# 기본서 - c# 2.0, Generic과 syntatic sugar"
date:   2018-12-05 17:42:00
tags: [c#, c#2.0, IEnumerator, AnonymousMethod, T, Generic, yield]
categories: study-log
---

### 새로운 제네릭 문법: <T>
- 제너릭의 박싱/언박싱 문제를 보완한 새로운 버전의 컬렉션이 2.0에 등장한다. 대표적인 예가 ArrayList -> List<T>
- <T>에 타입을 지정해주면 CLR이 JIT컴파일 시에 대응되는 타입을 대체해서 코드를 확장한다.
- 기존에 여러개의 타입인자를 지정해줘야했던 문제도 <T>를 지정하면서 한번에 해결할 수 있다.
{% highlight c# %}
public static void WriteLog<T>(T item)
{
    string output = string.Format("{0}: {1}", DateTime.Now, item);
}
{% endhighlight %}
- 이렇게 여러타입을 매개변수로 받으면 조건을 넣어줘야하는 경우가 있을 수 있다. 그럴땐 Where 예약어를 사용하면 된다.
    - T대신 K, V 등을 써서 여러개의 파라미터에 서로 다른 타입을 명시해줄수도 있고, 여기에 where문을 각각 지정줄수도 있다. (590p)
    - 아래의 예시에 있는 인터페이스 상속 조건 말고도 여러 타입을 지정해줄 수 있다.
  
        | 제약조건 | 설명 |
        |--------------|---------------|
        | where T: U | U형식 인수에 해당하는 타입이거나 상속받은 클래스만  |
        | where T: struct | 값 형식만 |
        | where T: class | 참조 형식만  |
        | where T: new() | 기본생성자(매개변수가 없는)가 정의된 타입만  |
{% highlight c# %}
public static T Max<T>(T item, T item2) where T : IComparable //[, ...] 조건을 여러개 받을 수도 있다
{
    if(item1.CompareTo(item2) >= 0)
        return item1;
    return item2;
}
{% endhighlight %}
- default 예약어: 제네릭 형식 매개변수로 전달된 값의 초기값을 반환해야하는 경우가 있을 수 있다. 이때 컴파일러가 자동으로 결정할 수 있도록 하는게 default(T) 예약어이다.


### yield return/break와 IEnumerator
- foreach문법은 IEnumerable, IEnumerator 인터페이스를 구현한 객체를 열거할때 사용할 수 있다.
    - 멤버는 아래와 같다
    {% highlight c# %}
    interface IEnumerable
    {
        IEnumerator GetEnumerator();
    }
    interface IEnumerator
    {
        bool MoveNext(); //다음 요소 위치로 이동, 더 이상 없으면 false 반환
        void Reset();       //초기 상태로 바꿈
        Object Current    //현재 위치의 요소를 가져오기
        {
            get;
        }
    }
    {% endhighlight %}
    - IEnumerable의 독특한 점은 "무한집합"을 표현할 수 있다는 것이다.
- IEnumerable, IEnumerator를 간편하게 구현하고싶다면 yield 예약어를 사용하면 된다.
    - yield return을 사용하면 다음번 해당 메서드를 호출했을때 마지막 yield return 다음 코드 부터 실행한다. (IEnumerator에 Current 멤버가 있는 것을 생각해보면 된다)
    - yield break을 사용하면 열거를 끝낼 수 있다. 


### 기타
- partial 클래스: C#컴파일러는 빌드 시에 '같은 프로젝트'에 있는 partial 클래스를 하나로 모아 단일 클래스로 빌드한다.
- nullable 형식:  System.Nullable<T>은 값이 없는 상태 자체를 표기하기 위한 타입으로, T? 형식으로 간편하게 표기할 수 있다. HasValue와 Value 두 가지 속성을 제공한다.
- 익명메서드: 이름이 없는 메서드로, 메서드가 일회성으로만 필요할때 편의상 사용된다(syntactic sugar)
    - delegate 예약어를 사용해 메서드의 코드를 전달한다.
    {% highlight c# %}
    delegate int? MyDevide(int a, int b)
    static void Main(string[] args)
    {
        MyDivde myFunc = delegate (int a, int b)
        {
            if (b==0)
                return null;
            return a/b;
        }
    }
    {% endhighlight %}